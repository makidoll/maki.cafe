name: Build and publish
on:
    push:
        branches:
            - main
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v1

            - uses: actions/cache@v2
              with:
                  path: "**/node_modules"
                  key: ${{ runner.os }}-modules-${{ hashFiles('**/yarn.lock') }}

            - name: Install packages
              run: yarn install

            - name: Build
              run: yarn build

            # - name: Deploy
            #   uses: peaceiris/actions-gh-pages@v3
            #   with:
            #       github_token: ${{ secrets.GITHUB_TOKEN }}
            #       publish_dir: ./dist/maki
            #       cname: maki.cafe

            - name: Publish
              run: |
                  npx -p "@getmeli/cli" meli upload ./dist/maki \
                    --url "https://meli.cutelab.space" \
                    --site "fc910c27-54b4-433e-963e-fd49b5d17b00" \
                    --token "$MELI_TOKEN" \
                    --release "$GITHUB_SHA"
              env:
                  MELI_TOKEN: ${{ secrets.MELI_TOKEN }}
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
